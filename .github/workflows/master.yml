# yamllint disable rule:comments-indentation
name: MasterCI

on: # yamllint disable-line rule:truthy
  push

jobs:
  CherryPick:
    runs-on: ubuntu-latest
    steps:
      - name: aaa
        run: |
          docker ps
          echo "123456ab" > abc
          cat abc | xargs -i docker login --username=hi50144685@aliyun.com registry.cn-hangzhou.aliyuncs.com --password {}
          
#          ping -c 5 registry.cn-hangzhou.aliyuncs.com

      - name: "Checkout ${{ github.ref }}"
        uses: actions/checkout@v2
        with:
          persist-credentials: false
          submodules: true

      - name: bbb
        run: |
          ls -al
          du -chs *
          docker ps
          cd ..
          tar cf ClickHouse.tar.gz ClickHouse
          echo "123456ab" > abc
          cat abc | xargs -i docker login --username=hi50144685@aliyun.com registry.cn-hangzhou.aliyuncs.com --password {}
          docker rm -f aaaaaabbbbbbccc
          docker run -itd --name aaaaaabbbbbbccc nginx
          docker cp ClickHouse.tar.gz aaaaaabbbbbbccc:/opt
          docker commit aaaaaabbbbbbccc registry.cn-hangzhou.aliyuncs.com/he3cloud/clickhouse:v2
          docker push registry.cn-hangzhou.aliyuncs.com/he3cloud/clickhouse:v2
          docker rm -f aaaaaabbbbbbccc


      - name: Cleanup
        run: |
          # define a directory for the output artifacts
          echo 123
#
#          output_dir="build_results"
#          mkdir -p build_results
#          ./docker/packager/packager --package-type=binary --output-dir "$output_dir"
#          ls -al build_results
